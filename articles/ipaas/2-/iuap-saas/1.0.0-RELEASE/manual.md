# Saas应用支撑组件说明

为了支持saas服务，部分应用支持组件提供类租户及系统维度的支持，使业务系统可以按找租户及系统维度进行隔离。

目前已提供支持saas的组件如下：

1. 编码规则
2. 业务日志
3. 后台任务
4. 附件管理
5. 组织
6. 安全日志


# 整体设计 #

** 1. 以上组件均在数据库中增加：租户ID、系统编码 两个字段。 **

主演用于记录当前操作的租户和系统ID。租户间数据的隔离策略：既支持通过数据表字段隔离，也支持通过独立的数据库实例进行隔离。

** 2. saas层组件在使用时接口不变，配合认证组件获取租户及系统ID。**

租户及系统通过登录成功后，会将用户的租户及系统ID写入Session中，每次浏览器发起请求时，通过认证组件认证当前用户的身份后，会将租户及系统id写入环境变量。应用支撑组件通过环境变量获取登录用户的租户及系统ID进行查询或数据的持久化。保证运行期的数据隔离。


# 使用说明

## 开发步骤

** 1.如果是使用jar的组件，在业务系统中引入认证组件iuap-auth **

具体参考认证组件的使用说明。

注：需要在认证组件的shiro配置文件中，将直接或间接使用应用支撑组件的controller服务配置通过statelessAuthc进行拦截。否则租户及系统信息无法传递给具体组件使用。

** 2.业务系统中引入应用支撑组件的saas层适配器。**

```

<dependency>
  <groupId>com.yonyou.iuap</groupId>
  <artifactId>iuap-generic-adapter</artifactId>
  <version>3.0.0-RC001</version>
</dependency>

```

** 3.如果需要使用动态数据源进行数据隔离，引入动态数据源组件iuap-saas-dynamicds **

具体参考动态数据源组件的使用说明。

** 4.具体组件的使用，参考具体组件的使用说明，接口无变化 **

## 服务组件开发步骤

服务组件目前主要包括：后台任务、附件管理。因为服务组件是以war包方式提供，在war包中默认提供了saas层支持，每个组件均单独的说明文档，请参考具体文档。
